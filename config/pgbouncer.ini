;; PgBouncer Configuration Template for Performance Testing
;; This is a reference configuration - the actual config is generated by Terraform

;; Database connections
[databases]
; Replace with your database details
testdb = host=your-rds-endpoint.amazonaws.com port=5432 dbname=testdb

;; PgBouncer settings
[pgbouncer]

;;; Administrative settings
logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/run/postgresql/pgbouncer.pid
listen_addr = 0.0.0.0
listen_port = 6432
unix_socket_dir = /var/run/postgresql
auth_file = /etc/pgbouncer/userlist.txt
auth_type = md5

;;; Pool settings - optimized for performance testing
; Transaction pooling gives best performance for this test
pool_mode = transaction

; Allow up to 1000 client connections
max_client_conn = 1000

; But only maintain ~100 connections to the database
default_pool_size = 100
min_pool_size = 25
reserve_pool_size = 25
reserve_pool_timeout = 5

; Global limits
max_db_connections = 100
max_user_connections = 1000

;;; Connection settings
; Reset connections between transactions for cleanliness
server_reset_query = DISCARD ALL

; Health checking
server_check_delay = 30
server_check_query = select 1

; Connection lifecycle
server_lifetime = 3600        ; 1 hour max connection age
server_idle_timeout = 600     ; 10 minutes idle timeout

;;; Client settings
client_idle_timeout = 0       ; No timeout for clients (they control this)
client_login_timeout = 60     ; 1 minute to establish connection

;;; Logging - useful for debugging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
stats_period = 60            ; Statistics interval

;;; Performance settings
; Ignore parameters that don't affect query results
ignore_startup_parameters = extra_float_digits

;;; Safety settings
application_name_add_host = 1

;;; Configuration file location
conffile = /etc/pgbouncer/pgbouncer.ini

;;; Optional: Different pooling modes for comparison
; Uncomment these for different test scenarios:

; Session pooling (better compatibility, less performance)
; pool_mode = session

; Statement pooling (maximum efficiency, limited compatibility)
; pool_mode = statement

;;; Optional: Disable prepared statements for transaction pooling
; disable_pqexec = 0

;;; Optional: Connection limits per database
; [databases]
; testdb = host=... pool_size=50 max_db_connections=50

;;; Optional: Different settings for different databases
; production_db = host=prod-host port=5432 dbname=production pool_size=200
; staging_db = host=staging-host port=5432 dbname=staging pool_size=50 